# Vocation Tile Scanner

**Status:** âœ… **READY TO USE**  
**Purpose:** Measure Character slot position on player boards for vocation tiles  
**Type:** Tile (same size as a card)  
**Version:** 1.0.0

---

## ðŸ“‹ Overview

The `Vocation Tile Scanner` is a calibration/development tool used to:
1. **Measure** the Character slot position on player boards (local coordinates)
2. **Test** vocation tile placement and removal
3. **Export** measured positions as code for VocationsController

Since all player boards are identical (only tags differ), you only need to measure **one location**, but the tool allows testing for all 4 colors.

---

## ðŸš€ Functionality

### **Measurement Mode:**
- Place scanner tile on Character slot of any player board
- Select target color (Y/B/R/G) or AUTO (detects nearest board)
- Click "MEASURE" to capture local position
- Position stored per color (even though boards are identical)

### **Testing Mode:**
- **TEST PLACE:** Places a vocation tile on selected player's board
- **TEST REMOVE:** Removes tile from selected player's board and returns to storage
- Tests tile placement/removal for all 4 colors

### **Export:**
- Generates Lua table with measured positions
- Ready to paste into VocationsController
- Prints to TTS console log

---

## ðŸŽ® UI Elements

### **Top Row: Mode & Color Selection**

1. **MODE Button** (Top Center):
   - **Label:** "MODE: [AUTO/Yellow/Blue/Red/Green]"
   - **Function:** Toggles between AUTO and color selection
   - **Click:** Cycles through AUTO â†’ Yellow â†’ Blue â†’ Red â†’ Green â†’ AUTO

2. **Color Buttons** (Y/B/R/G):
   - **Yellow (Y)** - Top Left
   - **Blue (B)** - Top Right
   - **Red (R)** - Bottom Left
   - **Green (G)** - Bottom Right
   - **Function:** Select target board color
   - **Alt-Click:** Switch to AUTO mode

### **Middle Row: Measurement**

3. **MEASURE Button** (Center):
   - **Label:** "MEASURE"
   - **Function:** Captures Character slot position
   - **Process:**
     1. If AUTO: Detects nearest board
     2. Converts scanner world position to board local coordinates
     3. Validates measurement (converts back to check error)
     4. Stores position for selected color

4. **EXPORT Button** (Below MEASURE):
   - **Label:** "EXPORT"
   - **Function:** Generates Lua table code
   - **Output:** Prints to TTS console log

### **Bottom Rows: Testing**

5. **TEST PLACE Buttons** (Y/B/R/G):
   - **Label:** "TEST\nPLACE\n[Y/B/R/G]"
   - **Function:** Tests tile placement on selected color's board
   - **Process:**
     1. Finds any vocation tile (prefers one not on any board)
     2. Places tile at measured position
     - Adds color tag to tile

6. **TEST REMOVE Buttons** (Y/B/R/G):
   - **Label:** "TEST\nREMOVE\n[Y/B/R/G]"
   - **Function:** Tests tile removal from selected color's board
   - **Process:**
     1. Finds tile on selected color's board
     2. Removes color tag
     3. Moves tile to storage position

---

## ðŸ”„ Usage Workflow

### **Step 1: Measure Character Slot Position**

1. **Place scanner tile** exactly on Character slot on any player board
2. **Select color:**
   - Click color button (Y/B/R/G) OR
   - Use AUTO mode (detects nearest board)
3. **Click "MEASURE"**
4. **Verify:** Should see "âœ… Measured [Color] Character slot" message

**Note:** Since all boards are identical, you only need to measure once. But you can measure all 4 colors if you want to verify they're the same.

### **Step 2: Export Code**

1. **Click "EXPORT"**
2. **Check TTS console log** (Window â†’ Console in TTS)
3. **Copy the generated code**
4. **Paste into VocationsController.lua**

### **Step 3: Test Tile Placement/Removal**

1. **Ensure you have vocation tiles** with tag `WLB_VOCATION_TILE`
2. **Click "TEST PLACE [Color]"** to place tile on board
3. **Verify:** Tile appears on Character slot with color tag
4. **Click "TEST REMOVE [Color]"** to remove tile
5. **Verify:** Tile returns to storage, color tag removed

---

## ðŸ“Š Export Format

The EXPORT function generates a Lua table:

```lua
-- === VOCATION CHARACTER SLOT POSITIONS ===
-- Generated by Vocation Tile Scanner v1.0.0
-- Copy this into VocationsController.lua

local CHARACTER_SLOT_LOCAL = {
  Yellow = {x=1.259, y=0.592, z=-0.238},
  Blue = {x=1.259, y=0.592, z=-0.238},  -- Same as Yellow (boards are identical)
  Red = {x=1.259, y=0.592, z=-0.238},   -- Same as Yellow
  Green = {x=1.259, y=0.592, z=-0.238}, -- Same as Yellow
}
```

This can be directly copied into VocationsController's `CHARACTER_SLOT_LOCAL` table.

---

## ðŸ”§ Technical Details

### **Coordinate System:**
- **World Coordinates:** Absolute 3D position on table
- **Local Coordinates:** Position relative to board's local origin
- **Conversion:** Uses `board.positionToLocal()` and `board.positionToWorld()`

### **Board Finding:**
- Uses tag-based search: `WLB_BOARD` + `WLB_COLOR_[Color]`
- AUTO mode: Finds nearest board by 2D distance (ignores Y height)

### **Precision:**
- Coordinates formatted to 3 decimal places
- Error calculation shows conversion accuracy
- Low error (< 0.001) indicates good measurement

### **Y Offset for Placement:**
- **Y offset:** `PLACEMENT_Y_OFFSET = 0.1` (added to measured Y coordinate)
- **Purpose:** Places tile slightly higher so it falls and settles properly
- **Benefit:** Prevents clipping issues when items are underneath
- **Adjustable:** Change `PLACEMENT_Y_OFFSET` in script if needed

### **Tile Finding:**
- **For placement:** Finds any vocation tile not on any board (no color tag)
- **For removal:** Finds tile with matching color tag on board

### **Storage Position:**
- Tiles removed from board are moved to `STORAGE_POSITION = {0, 5, 0}`
- Adjust this in the script if needed

---

## âš™ï¸ Configuration

### **Tags Required:**
- **Player Boards:** `WLB_BOARD` + `WLB_COLOR_[Color]`
- **Vocation Tiles:** `WLB_VOCATION_TILE`

### **Constants:**
- `TAG_BOARD = "WLB_BOARD"`
- `TAG_VOCATION_TILE = "WLB_VOCATION_TILE"`
- `COLOR_TAG_PREFIX = "WLB_COLOR_"`
- `STORAGE_POSITION = {0, 5, 0}` (adjust as needed)

---

## âš ï¸ Notes

- **Development Tool:** This is a calibration tool, not used during gameplay
- **One Measurement:** Since all boards are identical, you only need to measure once
- **Testing:** Use TEST buttons to verify tile placement/removal works correctly
- **Storage:** Adjust `STORAGE_POSITION` if you want tiles stored elsewhere
- **Console Output:** Export prints to TTS console (Window â†’ Console), not broadcast

---

## ðŸ”— Integration with VocationsController

The exported `CHARACTER_SLOT_LOCAL` table is used in VocationsController:

```lua
-- In VocationsController.lua
local CHARACTER_SLOT_LOCAL = {
  Yellow = {x=1.259, y=0.592, z=-0.238},  -- From scanner
  Blue = {x=1.259, y=0.592, z=-0.238},   -- Same (boards identical)
  Red = {x=1.259, y=0.592, z=-0.238},    -- Same
  Green = {x=1.259, y=0.592, z=-0.238},  -- Same
}

function placeTileOnBoard(tile, color)
  local board = findPlayerBoard(color)
  local localPos = CHARACTER_SLOT_LOCAL[color]
  local worldPos = board.positionToWorld(localPos)
  tile.setPositionSmooth(worldPos, false, true)
  tile.addTag("WLB_COLOR_" .. color)
end
```

---

## âœ… Status

**Ready to use!**

1. Create scanner tile (same size as a card)
2. Attach script: `ScannerVocationTile.lua`
3. Place on Character slot
4. Measure and export
5. Test tile placement/removal

---

**Next Steps:**
- Measure Character slot position
- Export code to VocationsController
- Test tile placement/removal functionality
